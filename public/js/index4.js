import{a as n,K as Q,r as m,o as R,b as V,L as K,u as W,v as X,d as _,e as u,l as P,i as b,j as Y,f as L,h as d,M as Z,k as j,_ as ee,n as oe,N as ae,F as te,q as se,p as le}from"./index.js";import{j as v,h as T}from"./db.js";import{a as ne,r as B,g as re,B as ue}from"./vue3-form-element.esm.min.js";const ce={key:1},ie={key:2,style:{height:"80vh","margin-top":"10px","margin-bottom":"5px"}},pe={__name:"index",props:{schemaKey:String,codeKey:String},setup(A){var S,x,N;const k=A,c=n(!0),p=Q();console.log(p);let r=p.query.schemaKey||k.schemaKey;p.query.codeKey||k.codeKey;let s=m({});console.log(r),console.log(v()),console.log(v()[r]);let z=((S=v()[r])==null?void 0:S.schema)||{},D=((x=v()[r])==null?void 0:x.formProps)||{};const H=m(z),J=m(D),a=n("form");a.value=r,console.log(a.value);const l=n("223"),g=n("text");if(a.value==="editorLayout"){if(window.services.ENTER.type==="files"){let e=window.services.ENTER.payload[0].path;l.value=window.services.sandbox.fs.readFileSync(e,"utf8")}else l.value=window.services.ENTER.payload;try{l.value=JSON.stringify(JSON.parse(l.value),null,2),g.value="json"}catch{}}const C=e=>{e.key==="s"&&e.ctrlKey&&(console.log("Ctrl + S 被按下"),E())};R(()=>{window.addEventListener("keydown",C)}),V(()=>{window.removeEventListener("keydown",C)});const E=()=>{console.log("paramsForm",s);let e=K(T(),"localResultFilePath")||"D:/tmp/result.txt";window.services.saveExecuteResult(s,e),B(),console.log("执行脚本完成"),c.value=!1},f=n(!0),y=e=>{f.value=!1,setTimeout(()=>{f.value=!0},10)};R(()=>{window.addEventListener("resize",y)}),V(()=>{window.removeEventListener("resize",y)});const O=K(T(),"switchLanguage")||[{value:"python",label:"python"},{value:"javascript",label:"javascript"},{value:"json",label:"json"},{value:"text",label:"text"}],q=e=>{g.value=e,y()},F=m({});try{let e=ne();e&&e&&Object.assign(F,e)}catch(e){console.log("处理前置脚本异常",e)}let M=W();const h=()=>{ae.emit("goHome",{status:!0}),M.push("/")};window.serviceApi.goHome||(window.serviceApi.goHome=h),window.serviceApi.run||(window.serviceApi.run=B);let i=re(),w="<template><h1>当前脚本未配置sfc内容</h1></template>";(N=i==null?void 0:i.basicForm)!=null&&N.sfc&&(w=X.config.getConfigNestedValue("SFC_MANAGE."+i.basicForm.sfc)||w);const U=n(w);return(e,t)=>{const $=_("el-option"),G=_("el-select"),I=_("el-button");return c.value&&a.value!=="editorLayout"&&a.value!=="customLayout"?(u(),P(b(ue),{key:0,modelValue:b(s),"onUpdate:modelValue":t[0]||(t[0]=o=>Y(s)?s.value=o:s=o),schema:H,formProps:J,onSubmit:E,onCancel:h,"ui-schema":F},null,8,["modelValue","schema","formProps","ui-schema"])):c.value&&a.value==="customLayout"?(u(),L("div",ce,[d(Z,{sfc:U.value},null,8,["sfc"])])):c.value&&a.value==="editorLayout"&&f.value?(u(),L("div",ie,[d(G,{modelValue:e.currentLanguageType,"onUpdate:modelValue":t[1]||(t[1]=o=>e.currentLanguageType=o),placeholder:"语法高亮",onChange:q,style:{margin:"5px"}},{default:j(()=>[(u(!0),L(te,null,se(b(O),o=>(u(),P($,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),d(I,{type:"primary",onClick:h},{default:j(()=>[le("返回")]),_:1}),d(ee,{onChangeData:t[2]||(t[2]=o=>{l.value=o}),language:g.value,code:l.value},null,8,["language","code"])])):oe("",!0)}}};export{pe as default};
