import{a as n,R as I,r as m,S as d,o as V,f as N,T as K,U as P,u as Q,C as X,h as _,i as u,s as T,n as b,p as Y,j as L,l as v,V as Z,q as j,_ as ee,v as oe,W as ae,F as te,y as se,x as le}from"./index.js";import{a as ne,r as B,g as re,B as ue}from"./vue3-form-element.esm.min.js";const ce={key:1},ie={key:2,style:{height:"80vh","margin-top":"10px","margin-bottom":"5px"}},ve={__name:"index",props:{schemaKey:String,codeKey:String},setup(A){var k,x,R;const C=A,c=n(!0),p=I();console.log(p);let r=p.query.schemaKey||C.schemaKey;p.query.codeKey||C.codeKey;let s=m({});console.log(r),console.log(d()),console.log(d()[r]);let z=((k=d()[r])==null?void 0:k.schema)||{},D=((x=d()[r])==null?void 0:x.formProps)||{};const H=m(z),J=m(D),a=n("form");a.value=r,console.log(a.value);const l=n("223"),g=n("text");if(a.value==="editorLayout"){if(window.services.ENTER.type==="files"){let e=window.services.ENTER.payload[0].path;l.value=window.services.sandbox.fs.readFileSync(e,"utf8")}else l.value=window.services.ENTER.payload;try{l.value=JSON.stringify(JSON.parse(l.value),null,2),g.value="json"}catch{}}const S=e=>{e.key==="s"&&e.ctrlKey&&(console.log("Ctrl + S 被按下"),E())};V(()=>{window.addEventListener("keydown",S)}),N(()=>{window.removeEventListener("keydown",S)});const E=()=>{console.log("paramsForm",s);let e=K(P(),"localResultFilePath")||"D:/tmp/result.txt";window.services.saveExecuteResult(s,e),B(),console.log("执行脚本完成"),c.value=!1},f=n(!0),y=e=>{f.value=!1,setTimeout(()=>{f.value=!0},10)};V(()=>{window.addEventListener("resize",y)}),N(()=>{window.removeEventListener("resize",y)});const O=K(P(),"switchLanguage")||[{value:"python",label:"python"},{value:"javascript",label:"javascript"},{value:"json",label:"json"},{value:"text",label:"text"}],U=e=>{g.value=e,y()},F=m({});try{let e=ne();e&&e&&Object.assign(F,e)}catch(e){console.log("处理前置脚本异常",e)}let q=Q();const h=()=>{ae.emit("goHome",{status:!0}),q.push("/")};window.serviceApi.goHome||(window.serviceApi.goHome=h),window.serviceApi.run||(window.serviceApi.run=B);let i=re(),w="<template><h1>当前脚本未配置sfc内容</h1></template>";(R=i==null?void 0:i.basicForm)!=null&&R.sfc&&(w=X.config.getConfigNestedValue("SFC_MANAGE."+i.basicForm.sfc)||w);const M=n(w);return(e,t)=>{const $=_("el-option"),G=_("el-select"),W=_("el-button");return c.value&&a.value!=="editorLayout"&&a.value!=="customLayout"?(u(),T(b(ue),{key:0,modelValue:b(s),"onUpdate:modelValue":t[0]||(t[0]=o=>Y(s)?s.value=o:s=o),schema:H,formProps:J,onSubmit:E,onCancel:h,"ui-schema":F},null,8,["modelValue","schema","formProps","ui-schema"])):c.value&&a.value==="customLayout"?(u(),L("div",ce,[v(Z,{sfc:M.value},null,8,["sfc"])])):c.value&&a.value==="editorLayout"&&f.value?(u(),L("div",ie,[v(G,{modelValue:e.currentLanguageType,"onUpdate:modelValue":t[1]||(t[1]=o=>e.currentLanguageType=o),placeholder:"语法高亮",onChange:U,style:{margin:"5px"}},{default:j(()=>[(u(!0),L(te,null,se(b(O),o=>(u(),T($,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),v(W,{type:"primary",onClick:h},{default:j(()=>[le("返回")]),_:1}),v(ee,{onChangeData:t[2]||(t[2]=o=>{l.value=o}),language:g.value,code:l.value},null,8,["language","code"])])):oe("",!0)}}};export{ve as default};
